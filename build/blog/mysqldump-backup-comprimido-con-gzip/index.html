



<!DOCTYPE html>
<html>
    <head>
    <title>Sopa de bits</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="A blog about data, information and Tech by Mario Alberich"/>
    <meta name="keywords" content="Statistics, Data, Experimentation, Technology, Data visualization" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.css"/>
    <link rel="stylesheet" href="/static/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/static/js/cookiecuttr/cookiecuttr.css"/>
    <link rel="stylesheet" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.min.css" media="print"/>
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap-theme.min.css" media="print" />
    </head>
    <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12 col-sm-3 col-md-2 nopad-l">
          <div class="sidebar-nav-fixed affix hidden-sm">
            <div class="well">
              <div class="row">
                <!-- <div class="col-xs-12">
                  <input class="form-control" type="text" id="search-query" name="q" placeholder="Search in sopadebits.com" data-toggle="popover" autocomplete="off">
                </div> -->
                <div class="col-xs-12 text-center">
                  <a href="https://sopadebits.com"><h1>Sopa de bits</h1></a>
                </div>
                <div class="col-xs-8 col-xs-offset-2 text-center">
                  <a href="https://sopadebits.com">
                    <img src="/static/images/avatar.jpg"
                      class="img img-responsive img-circle"
                      alt="Sopa de bits"
                      title="Sopa de bits" />
                  </a>
                </div>
                <div class="col-sm-10 col-sm-offset-1 hidden-xs text-center">
                  <p>A blog about data, information and Tech by Mario Alberich</p>
                </div>
                <div class="col-sm-12 hidden-xs" rel="icons">
                  
  
    <a target="_new" href="https://linkedin.com/in/marioalberich" alt="LinkedIn" title="LinkedIn">
      <span class="icon fa fa-2x fa-linkedin"></span>
    </a>&nbsp;&nbsp;
  
  
    <a target="_new" href="https://twitter.com/sopadebits" alt="Twitter" title="Twitter">
      <span class="icon fa fa-2x fa-twitter"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://github.com/malberich" alt="Github profile" title="Github profile">
      <span class="icon fa fa-2x fa-github"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://marioalberich.com" alt="Portfolio" title="Portfolio">
      <span class="icon fa fa-2x fa-user"></span>
    </a>
  

                </div>
                <div class="col-sm-10 col-sm-offset-1 hidden-xs">
                  
  <!-- render_site_categories -->
  <h3>Categories</h3>
  <div class="row">
    
      <div class="col-xs-2">
        <span class="badge">45</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/documentacion/">Documentación</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">40</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/economia/">Economía</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">139</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/informatica/">Informática</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">82</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/matematica/">Matemática</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">1</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/miscelanea/">Miscelánea</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">8</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/ocio/">Ocio</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">11</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/personas/">Personas</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">7</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/sin-categorizar/">Sin categorizar</a>
      </div>
  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="jumbotron visible-sm visible-xs">
            <div class="row">
                <div class="col-sm-2 col-sm-offset-0 col-xs-4 col-xs-offset-4 text-center">
                    <a href="https://sopadebits.com">
                        <img src="/static/images/avatar.jpg"
                          class="img img-responsive img-circle"
                          alt="Sopa de bits"
                          title="Sopa de bits" />
                    </a>
                </div>
                <div class="col-sm-10 col-xs-12">
                    <h1 class="hidden-xs"><a href="https://sopadebits.com">Sopa de bits</a></h1>
                    <h1 class="visible-xs text-center"><a href="https://sopadebits.com">Sopa de bits</a></h1>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-10 col-sm-offset-1 col-xs-12 text-center">
                  <p>A blog about data, information and Tech by Mario Alberich</p>
                </div>
                <div class="col-xs-12" rel="icons">
                  
  
    <a target="_new" href="https://linkedin.com/in/marioalberich" alt="LinkedIn" title="LinkedIn">
      <span class="icon fa fa-2x fa-linkedin"></span>
    </a>&nbsp;&nbsp;
  
  
    <a target="_new" href="https://twitter.com/sopadebits" alt="Twitter" title="Twitter">
      <span class="icon fa fa-2x fa-twitter"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://github.com/malberich" alt="Github profile" title="Github profile">
      <span class="icon fa fa-2x fa-github"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://marioalberich.com" alt="Portfolio" title="Portfolio">
      <span class="icon fa fa-2x fa-user"></span>
    </a>
  

                </div>
            </div>
        </div>
        <!-- <div
          id="search-results"
          style="background-color: #fff; border: 1px solid black; z-index:125; height: 50%; overflow: scroll; display: none; position:absolute" class="col-xs-12 col-sm-4 col-sm-offset-2">
        </div> -->
        <div class="col-xs-12 col-md-10 col-md-offset-2">
          
  
    
        <h1>mysqldump, backup comprimido con gzip</h1>
        <p>En algunas ocasiones el espacio disponible para almacenar copias de seguridad de la base de datos es escaso, por lo que quizá no disponemos del espacio para realizar un volcado completo de la base de datos, y en segunda fase comprimir ese resultado. También puede ser que queramos acortar el proceso evitando la escritura en disco (que puede ser lento), y al disponer de un cierto margen de CPU, podemos comprimir <em>al vuelo</em>.</p><!--more-->
<h2>Pipes</h2><br />
Suponiendo que el comando básico de mysqldump sea como sigue:</p>
<pre class="brush: shell; gutter: true">mysqldump --opt -u [usuario] -p[clave] [base_de_datos] > [copiaseguridad.sql]</pre><br />
Sabemos que mysqldump devuelve por <em>stdout</em> todo el texto de las sentencias SQL que conforman la base de datos. Eso se guarda en el archivo <em>copiaseguridad.sql</em>. &nbsp;Lo que se puede hacer es a&ntilde;adir un <em>pipe</em> hacia gzip, y que éste programa sea el que realmente genera el archivo de backup:</p>
<pre class="brush: shell; gutter: true">mysqldump -u [usuario] -p[clave] [base_de_datos] | gzip > [copiaseguridad.sql.gz]</pre><br />
En este caso, gzip capturará todo el contenido que antes enviábamos a copiaseguridad.sql y lo comprimirá. Una vez hecho esto, ahora sí, lo guardamos en un archivo. Por convención se le a&ntilde;ade el sufijo ".sql.gz", ya que de este modo queda claro que está comprimido y del contenido. &nbsp;Además, al descomprimir desaparece el ".gz", por lo que nos queda la extensión ".sql".</p>
<h2>Importar el archivo comprimido</h2><br />
Llega el fatídico día que requiere recuperar la base de datos. &nbsp;&iquest;Cómo procedemos? Vamos a incorporar a gunzip, la utilidad de descompresión. &nbsp;Como en el caso anterior, podríamos ejecutar gunzip y luego mysql. Pero la idea es economizar la escritura en disco, así que seguiremos usando pipes:</p>
<pre class="brush: shell; gutter: true">gunzip < [copiaseguridad.sql.gz] | mysql -u [usuario] -p[clave] [base_de_datos]</pre><br />
Simplemente:</p>
<ul>
<li>Enviamos a gunzip el contenido del archivo gz.</li>
<li>gunzip envía el resultado por <em>stdout</em>.</li>
<li>Este resultado es recogido por la <em>pipe</em> de mysql, que lo importa a <em>base_de_datos.</em></li><br />
</ul></p>
<h2>Ratios de compresión</h2><br />
Los archivos SQL son ni más ni menos que archivos de texto. En estos casos los ratios de compresión (tama&ntilde;o del archivo comprimido en comparación al archivo normal) son bastante notables, y pueden variar según el nivel de compresión. La contrapartida es que a mayor nivel de compresión, más uso de CPU (y más lento).</p>
<p>Sin embargo, si lo tuyo es una necesidad apremiante de espacio en disco, puedes a&ntilde;adir el nivel de compresión (entre 1 y 9, siendo 6 el valor por defecto) al ejecutar gzip:</p>
<pre class="brush: shell; gutter: true">mysqldump -u [usuario] -p[clave] [base_de_datos] | gzip -9 > [copiaseguridad.sql.gz]</pre><br />
Puedes hacer pruebas para revisar los ratios de compresión. La decisión final depende de todos los factores (CPU disponible, espacio/velocidad de disco, etc.).</p>
<p>En último término, también puedes usar <a title="Wikipedia: bzip2" href="http://en.wikipedia.org/wiki/Bzip2" target="_blank">bzip2</a>, aunque la <a title="A Quick Benchmark: Gzip vs. Bzip2 vs. LZMA" href="http://tukaani.org/lzma/benchmarks.html" target="_blank">relación entre velocidad y compresión respecto a gzip</a> puede desmotivarte.</p>
    


        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-2">
          
        </div>
        <div class="col-xs-12 col-md-offset-2">
          <p class="alert text-center">
            &copy; 2007 and beyond Mario Alberich, licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a> unless stated otherwise.
          </p>
        </div>
      </div>
    </div>
    <script type="text/javascript">
    $(document).ready(
      function (){
        $.cookieCuttr();
      }
    );
    </script>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap.min.js"></script>
    <script src="/static/js/search.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/cookiecuttr/jquery.cookiecuttr.js" type="text/javascript"></script>
    <script src="/static/js/cookiecuttr/js.cookie.js"></script>
  </body>
</html>
