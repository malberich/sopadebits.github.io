




<!DOCTYPE html>
<html>
    <head>
    <title>Sopa de bits</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="A blog about data, information and Tech by Mario Alberich"/>
    <meta name="keywords" content="Statistics, Data, Experimentation, Technology, Data visualization" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.css"/>
    <link rel="stylesheet" href="/static/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/static/js/cookiecuttr/cookiecuttr.css"/>
    <link rel="stylesheet" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.min.css" media="print"/>
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap-theme.min.css" media="print" />
    </head>
    <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12 col-sm-3 col-md-2 nopad-l">
          <div class="sidebar-nav-fixed affix hidden-sm">
            <div class="well">
              <div class="row">
                <!-- <div class="col-xs-12">
                  <input class="form-control" type="text" id="search-query" name="q" placeholder="Search in sopadebits.com" data-toggle="popover" autocomplete="off">
                </div> -->
                <div class="col-xs-12 text-center">
                  <a href="https://sopadebits.com"><h1>Sopa de bits</h1></a>
                </div>
                <div class="col-xs-8 col-xs-offset-2 text-center">
                  <a href="https://sopadebits.com">
                    <img src="/static/images/avatar.jpg"
                      class="img img-responsive img-circle"
                      alt="Sopa de bits"
                      title="Sopa de bits" />
                  </a>
                </div>
                <div class="col-sm-10 col-sm-offset-1 hidden-xs text-center">
                  <p>A blog about data, information and Tech by Mario Alberich</p>
                </div>
                <div class="col-sm-12 hidden-xs" rel="icons">
                  
  
    <a target="_new" href="https://linkedin.com/in/marioalberich" alt="LinkedIn" title="LinkedIn">
      <span class="icon fa fa-2x fa-linkedin"></span>
    </a>&nbsp;&nbsp;
  
  
    <a target="_new" href="https://twitter.com/sopadebits" alt="Twitter" title="Twitter">
      <span class="icon fa fa-2x fa-twitter"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://github.com/malberich" alt="Github profile" title="Github profile">
      <span class="icon fa fa-2x fa-github"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://marioalberich.com" alt="Portfolio" title="Portfolio">
      <span class="icon fa fa-2x fa-user"></span>
    </a>
  

                </div>
                <div class="col-sm-10 col-sm-offset-1 hidden-xs">
                  
  <!-- render_site_categories -->
  <h3>Categories</h3>
  <div class="row">
    
      <div class="col-xs-2">
        <span class="badge">45</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/documentacion/">Documentación</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">40</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/economia/">Economía</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">139</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/informatica/">Informática</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">82</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/matematica/">Matemática</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">1</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/miscelanea/">Miscelánea</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">8</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/ocio/">Ocio</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">11</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/personas/">Personas</a>
      </div>
      <div class="col-xs-2">
        <span class="badge">7</span>
      </div>
      <div class="col-xs-10">
        <a href="/categories/sin-categorizar/">Sin categorizar</a>
      </div>
  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="jumbotron visible-sm visible-xs">
            <div class="row">
                <div class="col-sm-2 col-sm-offset-0 col-xs-4 col-xs-offset-4 text-center">
                    <a href="https://sopadebits.com">
                        <img src="/static/images/avatar.jpg"
                          class="img img-responsive img-circle"
                          alt="Sopa de bits"
                          title="Sopa de bits" />
                    </a>
                </div>
                <div class="col-sm-10 col-xs-12">
                    <h1 class="hidden-xs"><a href="https://sopadebits.com">Sopa de bits</a></h1>
                    <h1 class="visible-xs text-center"><a href="https://sopadebits.com">Sopa de bits</a></h1>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-10 col-sm-offset-1 col-xs-12 text-center">
                  <p>A blog about data, information and Tech by Mario Alberich</p>
                </div>
                <div class="col-xs-12" rel="icons">
                  
  
    <a target="_new" href="https://linkedin.com/in/marioalberich" alt="LinkedIn" title="LinkedIn">
      <span class="icon fa fa-2x fa-linkedin"></span>
    </a>&nbsp;&nbsp;
  
  
    <a target="_new" href="https://twitter.com/sopadebits" alt="Twitter" title="Twitter">
      <span class="icon fa fa-2x fa-twitter"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://github.com/malberich" alt="Github profile" title="Github profile">
      <span class="icon fa fa-2x fa-github"></span>
    </a>&nbsp;&nbsp;
  
  
  
    <a target="_new" href="https://marioalberich.com" alt="Portfolio" title="Portfolio">
      <span class="icon fa fa-2x fa-user"></span>
    </a>
  

                </div>
            </div>
        </div>
        <!-- <div
          id="search-results"
          style="background-color: #fff; border: 1px solid black; z-index:125; height: 50%; overflow: scroll; display: none; position:absolute" class="col-xs-12 col-sm-4 col-sm-offset-2">
        </div> -->
        <div class="col-xs-12 col-md-10 col-md-offset-2">
          
  
    
        <h1>Apache: A&amp;ntilde;adir el tiempo de respuesta en los logs</h1>
        <p>Apache es una de esas herramientas tan complejas para las que todos utilizamos un porcentaje ínfimo de las opciones que incorpora (y tampoco necesitamos más). Esa complejidad probablemente será una de las razones por las que otros proyectos hayan apostado por alternativas más ligeras como nginx. Pero bueno, eso es otro tema. Aquí vamos a sacarle partido de esa complejidad.</p><!--more-->
<p>Los logs de Apache tienen un formato predefinido en la configuración por defecto. &nbsp;En el caso de Apache 2 en Ubuntu (y derivados de Debian), puedes encontrar una lista de los formatos de log dentro del archivo /etc/apache2/apache2.conf, con la directiva <a title="mod_log_config - LogFormat - Apache documentation" href="http://httpd.apache.org/docs/2.2/mod/mod_log_config.html#logformat">LogFormat</a>:</p>
<pre class="brush: bash; gutter: true">LogFormat "%v:%p %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined<br />
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined<br />
LogFormat "%h %l %u %t \"%r\" %>s %O" common<br />
LogFormat "%{Referer}i -> %U" referer<br />
LogFormat "%{User-agent}i" agent</pre></p>
<p class="brush: bash; gutter: false">Con lo anterior (en concreto con el formato <em>combined</em>) es perfectamente posible salir a la calle muy dignamente en la mayoría de casos. Eso ya nos aporta información sobre fechas, accesos, navegadores (incluyendo buscadores), respuestas y tama&ntilde;os en bytes.</p></p>
<h2 class="brush: bash; gutter: false">Crear un formato propio de log de Apache</h2><br />
Como puedes comprobar en los ejemplos por defecto, todas las variables vienen indicadas con un signo % y una lectra, o bien un %{nombre-entre-llaves} y una letra al final (para las variables de entorno la letra es la <em>e</em>, para las cabeceras de la petición es una&nbsp;<em>i</em>, etc.)</p>
<p>Para a&ntilde;adir un nuevo formato puedes partir de alguno de los casos anteriores (combined por ejemplo) y a&ntilde;adir tu variable:</p>
<pre class="brush: bash; gutter: true">LogFormat "%h %l %u %t \"%r\" %&amp;gt;s %O \"%{Referer}i\" \"%{User-Agent}i\" <strong>%I</strong>" sopadebits_combined</pre><br />
Puedes ver que hemos a&ntilde;adido el parámetro %I (número de bytes recibidos). Las dobles comillas puede que pasen desapercibidas pero son importantes: el formato de log va indicado dentro de comillas dobles, y si quieres a&ntilde;adir esas comillas dobles al log, es necesario escaparlas (\").</p>
<p>Con el log anterior, podemos acceder a nuestra configuración de host y modificar el formato del log que queremos:</p>
<pre class="brush: bash; gutter: false">CustomLog /var/log/apache2/localhost.log sopadebits_common</pre></p>
<h2>A&ntilde;adir el tiempo de respuesta al log de Apache</h2><br />
Ahora sí, ya estamos a punto. Vamos a a&ntilde;adir el tiempo. Pues vaya, resulta que tenemos dos variables:</p>
<ul>
<li>%T proporciona el tiempo en segundos.</li>
<li>%D lo proporciona en microsegundos</li><br />
</ul><br />
Pues ya puestos podríamos incluir las dos variables &iquest;verdad? Las a&ntilde;adiremos al final, después de user agent:</p>
<pre class="brush: bash; gutter: true">LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" %T %D" time_combined</pre><br />
Y como hemos hecho anteriormente, ya sólo debemos modificar la directiva CustomLog del virtualhost que queremos configurar con ese formato. Después de esto sólo queda utilizar un sistema para rastrear la información de los logs y detectar las peticiones más lentas. Pero eso queda para otra ocasión.</p>
<p>Otros casos podrían ser, por ejemplo, incluir el contenido de una cabecera de HTTP (por ejemplo generada por la propia aplicación) por ejemplo para llevar un control de las operaciones internas.</p>
    


        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-2">
          
        </div>
        <div class="col-xs-12 col-md-offset-2">
          <p class="alert text-center">
            &copy; 2007 and beyond Mario Alberich, licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a> unless stated otherwise.
          </p>
        </div>
      </div>
    </div>
    <script type="text/javascript">
    $(document).ready(
      function (){
        $.cookieCuttr();
      }
    );
    </script>
    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-3459440-1', 'auto');
    ga('send', 'pageview');
  </script>

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap.min.js"></script>
    <script src="/static/js/search.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/cookiecuttr/jquery.cookiecuttr.js" type="text/javascript"></script>
    <script src="/static/js/cookiecuttr/js.cookie.js"></script>
  </body>
</html>
